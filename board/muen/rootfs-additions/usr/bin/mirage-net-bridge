#!/bin/sh

CHAN_NAME=$1
DELIM="|"
if [ -z "$CHAN_NAME" ]
then
	CHAN_NAME="unikernel"
	DELIM="_"
fi

IN="$CHAN_NAME${DELIM}out"
OUT="$CHAN_NAME${DELIM}in"

DEV_NAME=$2
if [ -z "$DEV_NAME" ]
then
	DEV_NAME="net1"
fi

MODULE=/lib/modules/extra/muennet.ko
MOD_ARGS="reader_protocol=0x7ade5c549b08e814 writer_protocol=0x7ade5c549b08e814"
MOD_ARGS="$MOD_ARGS in=$IN out=$OUT flags=eth_dev"

mount -t debugfs none /sys/kernel/debug

insmod $MODULE name=$DEV_NAME $MOD_ARGS
ip link set $DEV_NAME master br0
ip link set dev $DEV_NAME up
