#!/bin/sh

DEV_NAME=net1
MODULE=/lib/modules/extra/muennet.ko
MOD_ARGS="reader_protocol=0x7ade5c549b08e814 writer_protocol=0x7ade5c549b08e814"
MOD_ARGS="$MOD_ARGS in=unikernel_out out=unikernel_in flags=eth_dev"

ip addr flush eth0
ip link set dev eth0 down
ip link add br0 type bridge
ip link set eth0 master br0
ip link set dev br0 up
ip link set dev eth0 up

mount -t debugfs none /sys/kernel/debug

insmod $MODULE name=$DEV_NAME $MOD_ARGS
ip link set $DEV_NAME master br0
ip link set dev $DEV_NAME up
